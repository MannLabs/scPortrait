<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pipeline &mdash; scPortrait  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=5c2dde8a" />
      <link rel="stylesheet" type="text/css" href="../../_static/fonts.css?v=5583d106" />


    <link rel="shortcut icon" href="../../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="processing" href="processing.html" />
    <link rel="prev" title="Module Documentation" href="../module.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



          <a href="../../index.html" class="icon icon-home">
            scPortrait
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">scPortrait Ecosystem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart/computational_workflow.html">scPortrait workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/computational_workflow.html#stitching">Stitching</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/computational_workflow.html#segmentation">Segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/computational_workflow.html#extraction">Extraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/computational_workflow.html#featurization">Featurization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart/computational_workflow.html#selection">Selection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../notebooks/example_scPortrait_project.html">A walk through the scPortrait Ecosystem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Import-Required-Libraries">Import Required Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Generate-the-Project-Structure">Generate the Project Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Load-Imaging-Data">Load Imaging Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Method-1:-loading-images-from-file">Method 1: loading images from file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Method-2:-loading-images-from-numpy-array">Method 2: loading images from numpy array</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Looking-at-the-loaded-images">Looking at the loaded images</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Generating-a-Segmentation">Generating a Segmentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Looking-at-Segmentation-Results">Looking at Segmentation Results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Extracting-single-cell-images">Extracting single-cell images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Look-at-extracted-single-cell-images">Look at extracted single-cell images</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Classification-of-extracted-single-cells">Classification of extracted single-cells</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#looking-at-the-generated-results">looking at the generated results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Exporting-Cutting-contours-for-excision-on-the-LMD7">Exporting Cutting contours for excision on the LMD7</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">scPortrait Workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/project.html">scPortrait Projects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pipeline/project.html#project-classes">Project classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/project.html#project">1. Project</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/project.html#timecourseproject">2. TimecourseProject</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../pipeline/project.html#initializing-a-scportrait-project">Initializing a scPortrait Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pipeline/project.html#loading-images-into-a-scportrait-project">Loading Images into a scPortrait project</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/config.html">Config Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/spatialdata.html">spatialdata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/stitching.html">stitching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/segmentation.html">Segmentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pipeline/segmentation.html#segmentation-classes">Segmentation classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/segmentation.html#id2">1. Segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/segmentation.html#shardedsegmentation">2. ShardedSegmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/segmentation.html#timecoursesegmentation">3. TimecourseSegmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/segmentation.html#multithreadedsegmentation">4. MultithreadedSegmentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../pipeline/segmentation.html#segmentation-workflows">Segmentation Workflows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/segmentation.html#wga-segmentation">WGA segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/segmentation.html#dapi-segmentation">DAPI segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/segmentation.html#cytosol-cellpose-segmentation">Cytosol Cellpose segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pipeline/segmentation.html#dapi-cellpose-segmentation">DAPI Cellpose segmentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/extraction.html">Extraction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pipeline/extraction.html#extraction-classes">Extraction classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../pipeline/extraction.html#single-cell-image-datasets">Single-cell image datasets</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/featurization.html">Featurization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/selection.html">Selection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../example_notebooks.html">Example Notebooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../example_notebooks.html#basic-scportrait-project">Basic scPortrait Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_scPortrait_project.html">A walk through the scPortrait Ecosystem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Import-Required-Libraries">Import Required Libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Generate-the-Project-Structure">Generate the Project Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Load-Imaging-Data">Load Imaging Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Generating-a-Segmentation">Generating a Segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Extracting-single-cell-images">Extracting single-cell images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Classification-of-extracted-single-cells">Classification of extracted single-cells</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_scPortrait_project.html#Exporting-Cutting-contours-for-excision-on-the-LMD7">Exporting Cutting contours for excision on the LMD7</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example_notebooks.html#segmentation-workflows">Segmentation Workflows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../notebooks/example_notebook_segmentation_workflows.html">Example Notebook showcasing the different segmentation workflows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_notebook_segmentation_workflows.html#WGA-Segmentation">WGA Segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_notebook_segmentation_workflows.html#DAPI-Segmentation">DAPI Segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_notebook_segmentation_workflows.html#Cytosol-Segmentation-Cellpose">Cytosol Segmentation Cellpose</a></li>
<li class="toctree-l4"><a class="reference internal" href="../notebooks/example_notebook_segmentation_workflows.html#DAPI-Segmentation-Cellpose">DAPI Segmentation Cellpose</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../example_notebooks.html#additional-notebooks">Additional Notebooks</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">scPortrait tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/parsing/parsing.html">parsing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/parsing/example_parsing_notebook.html">Example Parsing Notebook to rename phenix experiments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/stitching/stitching.html">stitching</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html">Example Stitching Notebook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#Single-threaded-Stitching">Single-threaded Stitching</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#initializing-the-stitcher-object">initializing the stitcher object</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#Generating-thumbnails">Generating thumbnails</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#Generating-full-scale-stitched-image">Generating full-scale stitched image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#Multi-threaded-Stitching">Multi-threaded Stitching</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#id1">initializing the stitcher object</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#id2">Generating thumbnails</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#id3">Generating full-scale stitched image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tools/stitching/example_stitching_notebook.html#Visualize-Stitching-Output">Visualize Stitching Output</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Module API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../module.html">Module Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#project">project</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Project</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#segmentation">segmentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Segmentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shardedsegmentation">ShardedSegmentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-scportrait.pipeline.segmentation.workflows">segmentation workflows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.WGASegmentation"><code class="docutils literal notranslate"><span class="pre">WGASegmentation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.ShardedWGASegmentation"><code class="docutils literal notranslate"><span class="pre">ShardedWGASegmentation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.DAPISegmentation"><code class="docutils literal notranslate"><span class="pre">DAPISegmentation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentation"><code class="docutils literal notranslate"><span class="pre">ShardedDAPISegmentation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.DAPISegmentationCellpose"><code class="docutils literal notranslate"><span class="pre">DAPISegmentationCellpose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentationCellpose"><code class="docutils literal notranslate"><span class="pre">ShardedDAPISegmentationCellpose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.CytosolSegmentationCellpose"><code class="docutils literal notranslate"><span class="pre">CytosolSegmentationCellpose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationCellpose"><code class="docutils literal notranslate"><span class="pre">ShardedCytosolSegmentationCellpose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.CytosolSegmentationDownsamplingCellpose"><code class="docutils literal notranslate"><span class="pre">CytosolSegmentationDownsamplingCellpose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationDownsamplingCellpose"><code class="docutils literal notranslate"><span class="pre">ShardedCytosolSegmentationDownsamplingCellpose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.CytosolOnlySegmentationCellpose"><code class="docutils literal notranslate"><span class="pre">CytosolOnlySegmentationCellpose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Cellpose_Segmentation"><code class="docutils literal notranslate"><span class="pre">Sharded_CytosolOnly_Cellpose_Segmentation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.CytosolOnly_Segmentation_Downsampling_Cellpose"><code class="docutils literal notranslate"><span class="pre">CytosolOnly_Segmentation_Downsampling_Cellpose</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Segmentation_Downsampling_Cellpose"><code class="docutils literal notranslate"><span class="pre">Sharded_CytosolOnly_Segmentation_Downsampling_Cellpose</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#extraction">extraction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hdf5cellextraction">HDF5CellExtraction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#classification">classification</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mlclusterclassifier">MLClusterClassifier</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cellfeaturizer">CellFeaturizer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#selection">selection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lmdselection">LMDSelection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="processing.html">processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="processing.html#module-scportrait.processing.images">images</a></li>
<li class="toctree-l3"><a class="reference internal" href="processing.html#module-scportrait.processing.masks">masks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="io.html">io</a><ul>
<li class="toctree-l3"><a class="reference internal" href="io.html#module-scportrait.io.daskmmap">memory mapped file handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="io.html#scportrait.io.daskmmap.dask_array_from_path"><code class="docutils literal notranslate"><span class="pre">dask_array_from_path()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#scportrait.io.daskmmap.calculate_chunk_sizes"><code class="docutils literal notranslate"><span class="pre">calculate_chunk_sizes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#scportrait.io.daskmmap.calculate_chunk_sizes_chunks"><code class="docutils literal notranslate"><span class="pre">calculate_chunk_sizes_chunks()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#scportrait.io.daskmmap.mmap_dask_array_contigious"><code class="docutils literal notranslate"><span class="pre">mmap_dask_array_contigious()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#scportrait.io.daskmmap.mmap_dask_array_chunked"><code class="docutils literal notranslate"><span class="pre">mmap_dask_array_chunked()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#scportrait.io.daskmmap.load_hdf5_contigious"><code class="docutils literal notranslate"><span class="pre">load_hdf5_contigious()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="io.html#scportrait.io.daskmmap.load_hdf5_chunk"><code class="docutils literal notranslate"><span class="pre">load_hdf5_chunk()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="io.html#module-scportrait.io.read">file readers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="io.html#scportrait.io.read.read_ome_zarr"><code class="docutils literal notranslate"><span class="pre">read_ome_zarr()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools/parsing.html">parse</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools/parsing.html#scportrait.tools.parse._parse_phenix.PhenixParser"><code class="docutils literal notranslate"><span class="pre">PhenixParser</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools/parsing.html#scportrait.tools.parse._parse_phenix.PhenixParser.copy_files"><code class="docutils literal notranslate"><span class="pre">PhenixParser.copy_files()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/parsing.html#scportrait.tools.parse._parse_phenix.PhenixParser.parse"><code class="docutils literal notranslate"><span class="pre">PhenixParser.parse()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/parsing.html#scportrait.tools.parse._parse_phenix.PhenixParser.sort_wells"><code class="docutils literal notranslate"><span class="pre">PhenixParser.sort_wells()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/parsing.html#scportrait.tools.parse._parse_phenix.PhenixParser.sort_timepoints"><code class="docutils literal notranslate"><span class="pre">PhenixParser.sort_timepoints()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tools/parsing.html#scportrait.tools.parse._parse_phenix.CombinedPhenixParser"><code class="docutils literal notranslate"><span class="pre">CombinedPhenixParser</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="tools/stitching.html">stitch</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher"><code class="docutils literal notranslate"><span class="pre">Stitcher</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.create_cache"><code class="docutils literal notranslate"><span class="pre">Stitcher.create_cache()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.clear_cache"><code class="docutils literal notranslate"><span class="pre">Stitcher.clear_cache()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.initialize_outdir"><code class="docutils literal notranslate"><span class="pre">Stitcher.initialize_outdir()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.get_channel_info"><code class="docutils literal notranslate"><span class="pre">Stitcher.get_channel_info()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.setup_rescaling"><code class="docutils literal notranslate"><span class="pre">Stitcher.setup_rescaling()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.reorder_channels"><code class="docutils literal notranslate"><span class="pre">Stitcher.reorder_channels()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.initialize_reader"><code class="docutils literal notranslate"><span class="pre">Stitcher.initialize_reader()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.save_positions"><code class="docutils literal notranslate"><span class="pre">Stitcher.save_positions()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.generate_thumbnail"><code class="docutils literal notranslate"><span class="pre">Stitcher.generate_thumbnail()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.initialize_aligner"><code class="docutils literal notranslate"><span class="pre">Stitcher.initialize_aligner()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.plot_qc"><code class="docutils literal notranslate"><span class="pre">Stitcher.plot_qc()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.perform_alignment"><code class="docutils literal notranslate"><span class="pre">Stitcher.perform_alignment()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.initialize_mosaic"><code class="docutils literal notranslate"><span class="pre">Stitcher.initialize_mosaic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.assemble_mosaic"><code class="docutils literal notranslate"><span class="pre">Stitcher.assemble_mosaic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.stitch"><code class="docutils literal notranslate"><span class="pre">Stitcher.stitch()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.write_tif"><code class="docutils literal notranslate"><span class="pre">Stitcher.write_tif()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.write_ome_zarr"><code class="docutils literal notranslate"><span class="pre">Stitcher.write_ome_zarr()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.write_thumbnail"><code class="docutils literal notranslate"><span class="pre">Stitcher.write_thumbnail()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.Stitcher.write_spatialdata"><code class="docutils literal notranslate"><span class="pre">Stitcher.write_spatialdata()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.ParallelStitcher"><code class="docutils literal notranslate"><span class="pre">ParallelStitcher</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.ParallelStitcher.initialize_aligner"><code class="docutils literal notranslate"><span class="pre">ParallelStitcher.initialize_aligner()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.ParallelStitcher.initialize_mosaic"><code class="docutils literal notranslate"><span class="pre">ParallelStitcher.initialize_mosaic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.ParallelStitcher.assemble_mosaic"><code class="docutils literal notranslate"><span class="pre">ParallelStitcher.assemble_mosaic()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/stitching.html#scportrait.tools.stitch._stitch.ParallelStitcher.write_tif_parallel"><code class="docutils literal notranslate"><span class="pre">ParallelStitcher.write_tif_parallel()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tools/ml.html">ml</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools/ml.html#module-scportrait.tools.ml.datasets">datasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/ml.html#module-scportrait.tools.ml.metrics">metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/ml.html#models">models</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/ml.html#plmodels">plmodels</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/ml.html#module-scportrait.tools.ml.pretrained_models">pretrained_models</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/ml.html#module-scportrait.tools.ml.transforms">transforms</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools/ml.html#module-scportrait.tools.ml.utils">utils</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">scPortrait</a>
      </nav>

      <div class="wy-nav-content">
<div class="git-ribbon">
  <a href="http://github.com/SwissDataScienceCenter" rel="me">Join us on GitHub</a>
</div>

        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../module.html">Module Documentation</a></li>
      <li class="breadcrumb-item active">pipeline</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/module/pipeline.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <section id="pipeline">
<h1>pipeline<a class="headerlink" href="#pipeline" title="Link to this heading"></a></h1>
<div class="toctree-wrapper compound">
</div>
<section id="project">
<h2>project<a class="headerlink" href="#project" title="Link to this heading"></a></h2>
<p>Within scPortrait, all operations are centered around the concept of a <code class="docutils literal notranslate"><span class="pre">Project</span></code>. A <code class="docutils literal notranslate"><span class="pre">Project</span></code> is a python class which manages all of the scPortrait processing steps and is the central element through which all operations are performed. Each <code class="docutils literal notranslate"><span class="pre">Project</span></code> directly maps to a directory on the file system which contains all of the inputs to a specific scPortrait run as well as the generated outputs. Depending on the structure of the data that is to be processed a different Project class is required. Please see <a class="reference internal" href="../pipeline/project.html#projects"><span class="std std-ref">here</span></a> for more information.</p>
<section id="id1">
<h3>Project<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.project.Project">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.project.</span></span><span class="sig-name descname"><span class="pre">Project</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">project_location</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segmentation_f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extraction_f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">classification_f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">selection_f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.project.Project" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Logable</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.project.Project.DEFAULT_IMAGE_DTYPE">
<span class="sig-name descname"><span class="pre">DEFAULT_IMAGE_DTYPE</span></span><a class="headerlink" href="#scportrait.pipeline.project.Project.DEFAULT_IMAGE_DTYPE" title="Link to this definition"></a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">uint16</span></code></p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.project.Project.DEFAULT_SEGMENTATION_DTYPE">
<span class="sig-name descname"><span class="pre">DEFAULT_SEGMENTATION_DTYPE</span></span><a class="headerlink" href="#scportrait.pipeline.project.Project.DEFAULT_SEGMENTATION_DTYPE" title="Link to this definition"></a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">uint32</span></code></p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.project.Project.DEFAULT_SINGLE_CELL_IMAGE_DTYPE">
<span class="sig-name descname"><span class="pre">DEFAULT_SINGLE_CELL_IMAGE_DTYPE</span></span><a class="headerlink" href="#scportrait.pipeline.project.Project.DEFAULT_SINGLE_CELL_IMAGE_DTYPE" title="Link to this definition"></a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal notranslate"><span class="pre">float16</span></code></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.project.Project.update_classification_f">
<span class="sig-name descname"><span class="pre">update_classification_f</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">classification_f</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#scportrait.pipeline.project.Project.update_classification_f" title="Link to this definition"></a></dt>
<dd><p>Update the classification method chosen for the project without reinitializing the entire project.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>classification_f</strong> (<em>class</em>) – The classification method that should be used for the project.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.project.Project.load_input_from_tif_files">
<span class="sig-name descname"><span class="pre">load_input_from_tif_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel_names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">crop</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.project.Project.load_input_from_tif_files" title="Link to this definition"></a></dt>
<dd><p>Load input image from a list of files. The channels need to be specified in the following order: nucleus, cytosol other channels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_paths</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – List containing paths to each channel like
[“path1/img.tiff”, “path2/img.tiff”, “path3/img.tiff”].
Expects a list of file paths with length “input_channel” as
defined in the config.yml.</p></li>
<li><p><strong>crop</strong> (<em>List</em><em>[</em><em>Tuple</em><em>]</em><em>, </em><em>optional</em>) – When set, it can be used to crop the input image. The first
element refers to the first dimension of the image and so on.
For example use “[(0,1000),(0,2000)]” to crop the image to
1000 px height and 2000 px width from the top left corner.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.project.Project.load_input_from_sdata">
<span class="sig-name descname"><span class="pre">load_input_from_sdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sdata_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_image_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'input_image'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nucleus_segmentation_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cytosol_segmentation_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.project.Project.load_input_from_sdata" title="Link to this definition"></a></dt>
<dd><p>Load input image from a spatialdata object.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.project.Project.select">
<span class="sig-name descname"><span class="pre">select</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cell_sets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calibration_marker</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segmentation_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'seg_all_nucleus'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.project.Project.select" title="Link to this definition"></a></dt>
<dd><p>Select specified classes using the defined selection method.</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="segmentation">
<h2>segmentation<a class="headerlink" href="#segmentation" title="Link to this heading"></a></h2>
<section id="id2">
<h3>Segmentation<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.</span></span><span class="sig-name descname"><span class="pre">Segmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">directory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nuc_seg_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cyto_seg_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_tmp_image_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">project_location</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">project</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filehandler</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessingStep</span></code></p>
<p>Segmentation helper class used for creating segmentation workflows.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation.maps">
<span class="sig-name descname"><span class="pre">maps</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation.maps" title="Link to this definition"></a></dt>
<dd><p>Segmentation workflows based on the <a class="reference internal" href="#scportrait.pipeline.segmentation.Segmentation" title="scportrait.pipeline.segmentation.Segmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Segmentation</span></code></a> class can use maps for saving and loading checkpoints and perform. Maps can be numpy arrays</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict(str)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation.DEFAULT_FILTER_ADDTIONAL_FILE">
<span class="sig-name descname"><span class="pre">DEFAULT_FILTER_ADDTIONAL_FILE</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation.DEFAULT_FILTER_ADDTIONAL_FILE" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str, default <code class="docutils literal notranslate"><span class="pre">filtered_classes.csv</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation.PRINT_MAPS_ON_DEBUG">
<span class="sig-name descname"><span class="pre">PRINT_MAPS_ON_DEBUG</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation.PRINT_MAPS_ON_DEBUG" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool, default <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation.identifier">
<span class="sig-name descname"><span class="pre">identifier</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation.identifier" title="Link to this definition"></a></dt>
<dd><p>Only set if called by <a class="reference internal" href="#scportrait.pipeline.segmentation.ShardedSegmentation" title="scportrait.pipeline.segmentation.ShardedSegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardedSegmentation</span></code></a>. Unique index of the shard.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, default <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation.window">
<span class="sig-name descname"><span class="pre">window</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation.window" title="Link to this definition"></a></dt>
<dd><p>Only set if called by <a class="reference internal" href="#scportrait.pipeline.segmentation.ShardedSegmentation" title="scportrait.pipeline.segmentation.ShardedSegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardedSegmentation</span></code></a>. Defines the window which is assigned to the shard. The window will be applied to the input. The first element refers to the first dimension of the image and so on. For example use <code class="docutils literal notranslate"><span class="pre">[(0,1000),(0,2000)]</span></code> To crop the image to <cite>1000 px height</cite> and <cite>2000 px width</cite> from the top left corner.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list(tuple), default <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation.input_path">
<span class="sig-name descname"><span class="pre">input_path</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation.input_path" title="Link to this definition"></a></dt>
<dd><p>Only set if called by <a class="reference internal" href="#scportrait.pipeline.segmentation.ShardedSegmentation" title="scportrait.pipeline.segmentation.ShardedSegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardedSegmentation</span></code></a>. Location of the input hdf5 file. During sharded segmentation the <a class="reference internal" href="#scportrait.pipeline.segmentation.ShardedSegmentation" title="scportrait.pipeline.segmentation.ShardedSegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShardedSegmentation</span></code></a> derived helper class will save the input image in form of a hdf5 file. This makes the input image available for parallel reading by the segmentation processes.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str, default <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># two maps are initialized</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map0&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;map1&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># its checked if the segmentation directory already contains these maps and they are then loaded. The index of the first map which has not been found is returned. It indicates the step where computation needs to resume</span>
    <span class="n">current_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_maps_from_disk</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">current_step</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># do stuff and generate map0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_map</span><span class="p">(</span><span class="s2">&quot;map0&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">current_step</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># do stuff and generate map1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_map</span><span class="p">(</span><span class="s2">&quot;map1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation.save_map">
<span class="sig-name descname"><span class="pre">save_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">map_name</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation.save_map" title="Link to this definition"></a></dt>
<dd><p>Saves newly computed map.</p>
<dl class="simple">
<dt>Args</dt><dd><p>map_name (str): name of the map to be saved, as defined in <code class="docutils literal notranslate"><span class="pre">self.maps</span></code>.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># declare all intermediate maps</span>
<span class="bp">self</span><span class="o">.</span><span class="n">maps</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;myMap&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

<span class="c1"># load intermediate maps if possible and get current processing step</span>
<span class="n">current_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_maps_from_disk</span><span class="p">()</span>

<span class="k">if</span> <span class="n">current_step</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># do some computations</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">maps</span><span class="p">[</span><span class="s2">&quot;myMap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">myNumpyArray</span>

    <span class="c1"># save map</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_map</span><span class="p">(</span><span class="s2">&quot;myMap&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.Segmentation.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.Segmentation.process" title="Link to this definition"></a></dt>
<dd><p>Process the input image with the segmentation method.</p>
</dd></dl>

</dd></dl>

</section>
<section id="shardedsegmentation">
<h3>ShardedSegmentation<a class="headerlink" href="#shardedsegmentation" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.ShardedSegmentation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.</span></span><span class="sig-name descname"><span class="pre">ShardedSegmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.ShardedSegmentation" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#scportrait.pipeline.segmentation.Segmentation" title="scportrait.pipeline.segmentation.segmentation.Segmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">Segmentation</span></code></a></p>
<p>To perform a sharded segmentation where the input image is split into individual tiles (with overlap) that are processed idnividually before the results are joined back together.</p>
<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.ShardedSegmentation.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.ShardedSegmentation.process" title="Link to this definition"></a></dt>
<dd><p>Process the input image with the sharded segmentation method.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This function is called automatically when a Segmentation Class is executed.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>input_image</strong> (<em>np.array</em>) – Input image to be processed. The input image should be a numpy array of shape (C, H, W) where C is the number of channels, H is the height of the image and W is the width of the image.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.ShardedSegmentation.complete_segmentation">
<span class="sig-name descname"><span class="pre">complete_segmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_run</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.ShardedSegmentation.complete_segmentation" title="Link to this definition"></a></dt>
<dd><p>Complete an already started sharded segmentation of the provided input image.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_image</strong> (<em>np.array</em>) – Input image to be processed. The input image should be a numpy array of shape (C, H, W) where C is the number of channels, H is the height of the image and W is the width of the image.</p></li>
<li><p><strong>force_run</strong> (<em>bool</em>) – If set to True the segmentation will be run even if a completed segmentation is already found in the sdata object. Default is False.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="module-scportrait.pipeline.segmentation.workflows">
<span id="segmentation-workflows"></span><h2>segmentation workflows<a class="headerlink" href="#module-scportrait.pipeline.segmentation.workflows" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.WGASegmentation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">WGASegmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.WGASegmentation" title="Link to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.WGASegmentation.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.WGASegmentation.process" title="Link to this definition"></a></dt>
<dd><p>Process the input image with the segmentation method.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedWGASegmentation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">ShardedWGASegmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedWGASegmentation" title="Link to this definition"></a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedWGASegmentation.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedWGASegmentation.method" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.WGASegmentation" title="scportrait.pipeline.segmentation.workflows.WGASegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">WGASegmentation</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.DAPISegmentation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">DAPISegmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.DAPISegmentation" title="Link to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.DAPISegmentation.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.DAPISegmentation.process" title="Link to this definition"></a></dt>
<dd><p>Process the input image with the segmentation method.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">ShardedDAPISegmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentation" title="Link to this definition"></a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentation.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentation.method" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.DAPISegmentation" title="scportrait.pipeline.segmentation.workflows.DAPISegmentation"><code class="xref py py-class docutils literal notranslate"><span class="pre">DAPISegmentation</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.DAPISegmentationCellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">DAPISegmentationCellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.DAPISegmentationCellpose" title="Link to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.DAPISegmentationCellpose.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.DAPISegmentationCellpose.process" title="Link to this definition"></a></dt>
<dd><p>Process the input image with the segmentation method.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentationCellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">ShardedDAPISegmentationCellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentationCellpose" title="Link to this definition"></a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentationCellpose.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedDAPISegmentationCellpose.method" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.DAPISegmentationCellpose" title="scportrait.pipeline.segmentation.workflows.DAPISegmentationCellpose"><code class="xref py py-class docutils literal notranslate"><span class="pre">DAPISegmentationCellpose</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.CytosolSegmentationCellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">CytosolSegmentationCellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.CytosolSegmentationCellpose" title="Link to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.CytosolSegmentationCellpose.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.CytosolSegmentationCellpose.process" title="Link to this definition"></a></dt>
<dd><p>Process the input image with the segmentation method.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationCellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">ShardedCytosolSegmentationCellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationCellpose" title="Link to this definition"></a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationCellpose.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationCellpose.method" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.CytosolSegmentationCellpose" title="scportrait.pipeline.segmentation.workflows.CytosolSegmentationCellpose"><code class="xref py py-class docutils literal notranslate"><span class="pre">CytosolSegmentationCellpose</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.CytosolSegmentationDownsamplingCellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">CytosolSegmentationDownsamplingCellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.CytosolSegmentationDownsamplingCellpose" title="Link to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.CytosolSegmentationDownsamplingCellpose.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.CytosolSegmentationDownsamplingCellpose.process" title="Link to this definition"></a></dt>
<dd><p>Process the input image with the segmentation method.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationDownsamplingCellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">ShardedCytosolSegmentationDownsamplingCellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationDownsamplingCellpose" title="Link to this definition"></a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationDownsamplingCellpose.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.ShardedCytosolSegmentationDownsamplingCellpose.method" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.CytosolSegmentationDownsamplingCellpose" title="scportrait.pipeline.segmentation.workflows.CytosolSegmentationDownsamplingCellpose"><code class="xref py py-class docutils literal notranslate"><span class="pre">CytosolSegmentationDownsamplingCellpose</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.CytosolOnlySegmentationCellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">CytosolOnlySegmentationCellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.CytosolOnlySegmentationCellpose" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Cellpose_Segmentation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">Sharded_CytosolOnly_Cellpose_Segmentation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Cellpose_Segmentation" title="Link to this definition"></a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Cellpose_Segmentation.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Cellpose_Segmentation.method" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.CytosolOnlySegmentationCellpose" title="scportrait.pipeline.segmentation.workflows.CytosolOnlySegmentationCellpose"><code class="xref py py-class docutils literal notranslate"><span class="pre">CytosolOnlySegmentationCellpose</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.CytosolOnly_Segmentation_Downsampling_Cellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">CytosolOnly_Segmentation_Downsampling_Cellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.CytosolOnly_Segmentation_Downsampling_Cellpose" title="Link to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.CytosolOnly_Segmentation_Downsampling_Cellpose.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_image</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.CytosolOnly_Segmentation_Downsampling_Cellpose.process" title="Link to this definition"></a></dt>
<dd><p>Process the input image with the segmentation method.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Segmentation_Downsampling_Cellpose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.segmentation.workflows.</span></span><span class="sig-name descname"><span class="pre">Sharded_CytosolOnly_Segmentation_Downsampling_Cellpose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Segmentation_Downsampling_Cellpose" title="Link to this definition"></a></dt>
<dd><dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Segmentation_Downsampling_Cellpose.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#scportrait.pipeline.segmentation.workflows.Sharded_CytosolOnly_Segmentation_Downsampling_Cellpose.method" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#scportrait.pipeline.segmentation.workflows.CytosolOnly_Segmentation_Downsampling_Cellpose" title="scportrait.pipeline.segmentation.workflows.CytosolOnly_Segmentation_Downsampling_Cellpose"><code class="xref py py-class docutils literal notranslate"><span class="pre">CytosolOnly_Segmentation_Downsampling_Cellpose</span></code></a></p>
</dd></dl>

</dd></dl>

</section>
<section id="extraction">
<h2>extraction<a class="headerlink" href="#extraction" title="Link to this heading"></a></h2>
<section id="hdf5cellextraction">
<h3>HDF5CellExtraction<a class="headerlink" href="#hdf5cellextraction" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.extraction.HDF5CellExtraction">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.extraction.</span></span><span class="sig-name descname"><span class="pre">HDF5CellExtraction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.extraction.HDF5CellExtraction" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessingStep</span></code></p>
<p>A class to extracts single cell images from a segmented scPortrait project and save the
results to an HDF5 file.</p>
<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.extraction.HDF5CellExtraction.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partial</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_cells</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.extraction.HDF5CellExtraction.process" title="Link to this definition"></a></dt>
<dd><p>Extracts single cell images from a segmented scPortrait project and saves the results to an HDF5 file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_segmentation_path</strong> (<em>str</em>) – Path of the segmentation HDF5 file. If this class is used as part of a project processing workflow, this argument will be provided automatically.</p></li>
<li><p><strong>filtered_classes_path</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the filtered classes that should be used for extraction. Default is None. If not provided, will use the automatically generated paths.</p></li>
</ul>
</dd>
</dl>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If this class is used as part of a project processing workflow, all of the arguments will be provided by the <code class="docutils literal notranslate"><span class="pre">Project</span></code> class based on the previous segmentation.
The Project class will automatically provide the most recent segmentation forward together with the supplied parameters.</p>
</div>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># After project is initialized and input data has been loaded and segmented</span>
<span class="n">project</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<p>The following parameters are required in the config file when running this method:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">HDF5CellExtraction</span><span class="p">:</span>

<span class="w">    </span><span class="nt">compression</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="w">    </span><span class="c1"># threads used in multithreading</span>
<span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>

<span class="w">    </span><span class="c1"># image size in pixels</span>
<span class="w">    </span><span class="nt">image_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>

<span class="w">    </span><span class="c1"># directory where intermediate results should be saved</span>
<span class="w">    </span><span class="nt">cache</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/mnt/temp/cache&quot;</span>

<span class="w">    </span><span class="c1"># specs to define how HDF5 data should be chunked and saved</span>
<span class="w">    </span><span class="nt">hdf5_rdcc_nbytes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5242880000</span><span class="w"> </span><span class="c1"># 5GB 1024 * 1024 * 5000</span>
<span class="w">    </span><span class="nt">hdf5_rdcc_w0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">hdf5_rdcc_nslots</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50000</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="classification">
<h2>classification<a class="headerlink" href="#classification" title="Link to this heading"></a></h2>
<section id="mlclusterclassifier">
<h3>MLClusterClassifier<a class="headerlink" href="#mlclusterclassifier" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.classification.MLClusterClassifier">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.classification.</span></span><span class="sig-name descname"><span class="pre">MLClusterClassifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.classification.MLClusterClassifier" title="Link to this definition"></a></dt>
<dd><p>Class for classifying single cells using a pre-trained machine learning model.</p>
<p>This class takes a pre-trained model and uses it to classify single cells,
using the model’s forward function or encoder function, depending on the
user’s choice. The classification results are saved to a CSV file.</p>
<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.classification.MLClusterClassifier.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.classification.MLClusterClassifier.__call__" title="Link to this definition"></a></dt>
<dd><p>Call the processing step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>debug</strong> (bool, optional, default <code class="docutils literal notranslate"><span class="pre">None</span></code>) – Allows overriding the value set on initiation. When set to True debug outputs will be printed where applicable.</p></li>
<li><p><strong>overwrite</strong> (bool, optional, default <code class="docutils literal notranslate"><span class="pre">None</span></code>) – Allows overriding the value set on initiation. When set to True, the processing step directory will be completely deleted and newly created when called.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.classification.MLClusterClassifier.DEFAULT_MODEL_CLASS">
<span class="sig-name descname"><span class="pre">DEFAULT_MODEL_CLASS</span></span><a class="headerlink" href="#scportrait.pipeline.classification.MLClusterClassifier.DEFAULT_MODEL_CLASS" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="tools/ml.html#scportrait.tools.ml.plmodels.MultilabelSupervisedModel" title="scportrait.tools.ml.plmodels.MultilabelSupervisedModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultilabelSupervisedModel</span></code></a></p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="scportrait.pipeline.classification.MLClusterClassifier.DEFAULT_DATA_LOADER">
<span class="sig-name descname"><span class="pre">DEFAULT_DATA_LOADER</span></span><a class="headerlink" href="#scportrait.pipeline.classification.MLClusterClassifier.DEFAULT_DATA_LOADER" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="tools/ml.html#scportrait.tools.ml.datasets.HDF5SingleCellDataset" title="scportrait.tools.ml.datasets.HDF5SingleCellDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">HDF5SingleCellDataset</span></code></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.classification.MLClusterClassifier.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">extraction_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.classification.MLClusterClassifier.process" title="Link to this definition"></a></dt>
<dd><p>Perform classification on the provided HDF5 dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>extraction_dir</strong> (<em>str</em>) – Directory containing the extracted HDF5 files from the project. If this class is used as part of
a project processing workflow, this argument will be provided automatically.</p></li>
<li><p><strong>size</strong> (<em>int</em><em>, </em><em>optional</em>) – How many cells should be selected for inference. Default is 0, which means all cells are selected.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Results are written to CSV files located in the project directory.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If this class is used as part of a project processing workflow, the first argument will be provided by the <code class="docutils literal notranslate"><span class="pre">Project</span></code>
class based on the previous single-cell extraction. Therefore, only the second and third arguments need to be provided.
The Project class will automatically provide the most recent extracted single-cell dataset together with the supplied parameters.</p>
</div>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">project</span><span class="o">.</span><span class="n">classify</span><span class="p">()</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<p>The following parameters are required in the config file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">MLClusterClassifier</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Channel number on which the classification should be performed</span>
<span class="w">    </span><span class="nt">channel_classification</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>

<span class="w">    </span><span class="c1"># Number of threads to use for dataloader</span>
<span class="w">    </span><span class="nt">dataloader_worker_number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">24</span>

<span class="w">    </span><span class="c1"># Batch size to pass to GPU</span>
<span class="w">    </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900</span>

<span class="w">    </span><span class="c1"># Path to PyTorch checkpoint that should be used for inference</span>
<span class="w">    </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;path/to/model/&quot;</span>

<span class="w">    </span><span class="c1"># Classifier architecture implemented in scPortrait</span>
<span class="w">    </span><span class="c1"># Choose one of VGG1, VGG2, VGG1_old, VGG2_old</span>
<span class="w">    </span><span class="nt">classifier_architecture</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;VGG2_old&quot;</span>

<span class="w">    </span><span class="c1"># If more than one checkpoint is provided in the network directory, which checkpoint should be chosen</span>
<span class="w">    </span><span class="c1"># Should either be &quot;max&quot; or a numeric value indicating the epoch number</span>
<span class="w">    </span><span class="nt">epoch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;max&quot;</span>

<span class="w">    </span><span class="c1"># Name of the classifier used for saving the classification results to a directory</span>
<span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Autophagy_15h_classifier1&quot;</span>

<span class="w">    </span><span class="c1"># List of which inference methods should be performed</span>
<span class="w">    </span><span class="c1"># Available: &quot;forward&quot; and &quot;encoder&quot;</span>
<span class="w">    </span><span class="c1"># If &quot;forward&quot;: images are passed through all layers of the model and the final inference results are written to file</span>
<span class="w">    </span><span class="c1"># If &quot;encoder&quot;: activations at the end of the CNN are written to file</span>
<span class="w">    </span><span class="nt">encoders</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;forward&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;encoder&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="c1"># On which device inference should be performed</span>
<span class="w">    </span><span class="c1"># For speed, should be &quot;cuda&quot;</span>
<span class="w">    </span><span class="nt">inference_device</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cuda&quot;</span>

<span class="w">    </span><span class="c1">#define dataset transforms</span>
<span class="w">    </span><span class="nt">transforms</span><span class="p">:</span>
<span class="w">        </span><span class="nt">resize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="cellfeaturizer">
<h3>CellFeaturizer<a class="headerlink" href="#cellfeaturizer" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.classification.CellFeaturizer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.classification.</span></span><span class="sig-name descname"><span class="pre">CellFeaturizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.classification.CellFeaturizer" title="Link to this definition"></a></dt>
<dd><p>Class for extracting general image features from SPARCS single-cell image datasets.
The extracted features are saved to a CSV file. The features are calculated on the basis of a specified channel.</p>
<p>The features which are calculated are:</p>
<ul class="simple">
<li><p>Area of the masks in pixels</p></li>
<li><p>Mean intensity of the chosen channel in the regions labelled by each of the masks</p></li>
<li><p>Median intensity of the chosen channel in the regions labelled by each of the masks</p></li>
<li><p>75% quantile of the chosen channel in the regions labelled by each of the masks</p></li>
<li><p>25% quantile of the chosen channel in the regions labelled by each of the masks</p></li>
<li><p>Summed intensity of the chosen channel in the regions labelled by each of the masks</p></li>
<li><p>Summed intensity of the chosen channel in the region labelled by each of the masks normalized for area</p></li>
</ul>
<p>The features are outputed in this order in the CSV file.</p>
<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.classification.CellFeaturizer.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overwrite</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.classification.CellFeaturizer.__call__" title="Link to this definition"></a></dt>
<dd><p>Call the processing step.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>debug</strong> (bool, optional, default <code class="docutils literal notranslate"><span class="pre">None</span></code>) – Allows overriding the value set on initiation. When set to True debug outputs will be printed where applicable.</p></li>
<li><p><strong>overwrite</strong> (bool, optional, default <code class="docutils literal notranslate"><span class="pre">None</span></code>) – Allows overriding the value set on initiation. When set to True, the processing step directory will be completely deleted and newly created when called.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.classification.CellFeaturizer.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">extraction_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.classification.CellFeaturizer.process" title="Link to this definition"></a></dt>
<dd><p>Perform featurization on the provided HDF5 dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>extraction_dir</strong> (<em>str</em>) – Directory containing the extracted HDF5 files from the project. If this class is used as part of a project processing workflow this argument will be provided automatically.</p></li>
<li><p><strong>size</strong> (<em>int</em><em>, </em><em>optional</em><em>, </em><em>default=0</em>) – How many cells should be selected for inference. Default is 0, meaning all cells are selected.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Results are written to CSV files located in the project directory.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If this class is used as part of a project processing workflow, the first argument will be provided by the <code class="docutils literal notranslate"><span class="pre">Project</span></code> class based on the previous single-cell extraction. Therefore, only the second and third argument need to be provided. The Project class will automatically provide the most recent extraction results together with the supplied parameters.</p>
</div>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define accessory dataset: additional HDF5 datasets that you want to perform an inference on</span>
<span class="c1"># Leave empty if you only want to infer on all extracted cells in the current project</span>

<span class="n">project</span><span class="o">.</span><span class="n">classify</span><span class="p">()</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<p>The following parameters are required in the config file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">CellFeaturizer</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># Channel number on which the featurization should be performed</span>
<span class="w">    </span><span class="nt">channel_classification</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>

<span class="w">    </span><span class="c1"># Number of threads to use for dataloader</span>
<span class="w">    </span><span class="nt">dataloader_worker_number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># needs to be 0 if using CPU</span>

<span class="w">    </span><span class="c1"># Batch size to pass to GPU</span>
<span class="w">    </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">900</span>

<span class="w">    </span><span class="c1"># On which device inference should be performed</span>
<span class="w">    </span><span class="c1"># For speed should be &quot;cuda&quot;</span>
<span class="w">    </span><span class="nt">inference_device</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cpu&quot;</span>

<span class="w">    </span><span class="c1"># Label under which the results should be saved</span>
<span class="w">    </span><span class="nt">screen_label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch3_Featurization&quot;</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="selection">
<h2>selection<a class="headerlink" href="#selection" title="Link to this heading"></a></h2>
<section id="lmdselection">
<h3>LMDSelection<a class="headerlink" href="#lmdselection" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="scportrait.pipeline.selection.LMDSelection">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scportrait.pipeline.selection.</span></span><span class="sig-name descname"><span class="pre">LMDSelection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.selection.LMDSelection" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ProcessingStep</span></code></p>
<p>Select single cells from a segmented sdata file and generate cutting data for the Leica LMD microscope.
This method class relies on the functionality of the pylmd library.</p>
<dl class="py method">
<dt class="sig sig-object py" id="scportrait.pipeline.selection.LMDSelection.process">
<span class="sig-name descname"><span class="pre">process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">segmentation_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_sets</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calibration_marker</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#scportrait.pipeline.selection.LMDSelection.process" title="Link to this definition"></a></dt>
<dd><p>Process function for selecting cells and generating their XML.
Under the hood this method relies on the pylmd library and utilizies its <cite>SegmentationLoader</cite> Class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>segmentation_name</strong> (<em>str</em>) – Name of the segmentation to be used for shape generation in the sdata object.</p></li>
<li><p><strong>cell_sets</strong> (<em>list</em><em> of </em><em>dict</em>) – List of dictionaries containing the sets of cells which should be sorted into a single well. Mandatory keys for each dictionary are: name, classes. Optional keys are: well.</p></li>
<li><p><strong>calibration_marker</strong> (<em>numpy.array</em>) – Array of size ‘(3,2)’ containing the calibration marker coordinates in the ‘(row, column)’ format.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calibration marker should be defined as (row, column).</span>
<span class="n">marker_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">])</span>
<span class="n">marker_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1100</span><span class="p">])</span>
<span class="n">marker_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">505</span><span class="p">])</span>

<span class="c1"># A numpy Array of shape (3, 2) should be passed.</span>
<span class="n">calibration_marker</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">marker_0</span><span class="p">,</span> <span class="n">marker_1</span><span class="p">,</span> <span class="n">marker_2</span><span class="p">])</span>


<span class="c1"># Sets of cells can be defined by providing a name and a list of classes in a dictionary.</span>
<span class="n">cells_to_select</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dataset1&quot;</span><span class="p">,</span> <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}]</span>

<span class="c1"># Alternatively, a path to a csv file can be provided.</span>
<span class="c1"># If a relative path is provided, it is accessed relativ to the projects base directory.</span>
<span class="n">cells_to_select</span> <span class="o">+=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dataset2&quot;</span><span class="p">,</span> <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="s2">&quot;segmentation/class_subset.csv&quot;</span><span class="p">}]</span>

<span class="c1"># If desired, wells can be passed with the individual sets.</span>
<span class="n">cells_to_select</span> <span class="o">+=</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;dataset3&quot;</span><span class="p">,</span> <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="s2">&quot;well&quot;</span><span class="p">:</span> <span class="s2">&quot;A1&quot;</span><span class="p">}]</span>

<span class="n">project</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">cells_to_select</span><span class="p">,</span> <span class="n">calibration_marker</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following parameters are required in the config file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">LMDSelection</span><span class="p">:</span>
<span class="w">    </span><span class="c1">#the number of threads with which multithreaded tasks should be executed</span>
<span class="w">    </span><span class="nt">threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="w">    </span><span class="c1"># the number of parallel processes to use for generation of cell sets each set</span>
<span class="w">    </span><span class="c1"># will processed with the designated number of threads</span>
<span class="w">    </span><span class="nt">processes_cell_sets</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="w">    </span><span class="c1"># defines the channel used for generating cutting masks</span>
<span class="w">    </span><span class="c1"># segmentation.hdf5 =&gt; labels =&gt; segmentation_channel</span>
<span class="w">    </span><span class="c1"># When using WGA segmentation:</span>
<span class="w">    </span><span class="c1">#    0 corresponds to nuclear masks</span>
<span class="w">    </span><span class="c1">#    1 corresponds to cytosolic masks.</span>
<span class="w">    </span><span class="nt">segmentation_channel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="w">    </span><span class="c1"># dilation of the cutting mask in pixel</span>
<span class="w">    </span><span class="nt">shape_dilation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="w">    </span><span class="c1"># Cutting masks are transformed by binary dilation and erosion</span>
<span class="w">    </span><span class="nt">binary_smoothing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">    </span><span class="c1"># number of datapoints which are averaged for smoothing</span>
<span class="w">    </span><span class="c1"># the number of datapoints over an distance of n pixel is 2*n</span>
<span class="w">    </span><span class="nt">convolution_smoothing</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25</span>

<span class="w">    </span><span class="c1"># fold reduction of datapoints for compression</span>
<span class="w">    </span><span class="nt">poly_compression_factor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="w">    </span><span class="c1"># Optimization of the cutting path inbetween shapes</span>
<span class="w">    </span><span class="c1"># optimized paths improve the cutting time and the microscopes focus</span>
<span class="w">    </span><span class="c1"># valid options are [&quot;none&quot;, &quot;hilbert&quot;, &quot;greedy&quot;]</span>
<span class="w">    </span><span class="nt">path_optimization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hilbert&quot;</span>

<span class="w">    </span><span class="c1"># Paramter required for hilbert curve based path optimization.</span>
<span class="w">    </span><span class="c1"># Defines the order of the hilbert curve used, which needs to be tuned with the total cutting area.</span>
<span class="w">    </span><span class="c1"># For areas of 1 x 1 mm we recommend at least p = 4,  for whole slides we recommend p = 7.</span>
<span class="w">    </span><span class="nt">hilbert_p</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>

<span class="w">    </span><span class="c1"># Parameter required for greedy path optimization.</span>
<span class="w">    </span><span class="c1"># Instead of a global distance matrix, the k nearest neighbours are approximated.</span>
<span class="w">    </span><span class="c1"># The optimization problem is then greedily solved for the known set of nearest neighbours until the first set of neighbours is exhausted.</span>
<span class="w">    </span><span class="c1"># Established edges are then removed and the nearest neighbour approximation is recursivly repeated.</span>
<span class="w">    </span><span class="nt">greedy_k</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>

<span class="w">    </span><span class="c1"># The LMD reads coordinates as integers which leads to rounding of decimal places.</span>
<span class="w">    </span><span class="c1"># Points spread between two whole coordinates are therefore collapsed to whole coordinates.</span>
<span class="w">    </span><span class="c1"># This can be mitigated by scaling the entire coordinate system by a defined factor.</span>
<span class="w">    </span><span class="c1"># For a resolution of 0.6 um / px a factor of 100 is recommended.</span>
<span class="w">    </span><span class="nt">xml_decimal_transform</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>

<span class="w">    </span><span class="c1"># Overlapping shapes are merged based on a nearest neighbour heuristic.</span>
<span class="w">    </span><span class="c1"># All selected shapes closer than distance_heuristic pixel are checked for overlap.</span>
<span class="w">    </span><span class="nt">distance_heuristic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span>
</pre></div>
</div>
</div>
</dd></dl>

</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../module.html" class="btn btn-neutral float-left" title="Module Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="processing.html" class="btn btn-neutral float-right" title="processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024 Sophia Mädler and Niklas Schmacke.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
